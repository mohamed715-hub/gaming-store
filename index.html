<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRO GAMER HUB</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/808/808439.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† --- */
        :root { --main: #ff0000; --gold: #ffd700; --bg: #0a0a0a; --card: #141414; --text: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 100px; overflow-x: hidden; }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--main); border-radius: 4px; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Loader) --- */
        #globalLoader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .spinner {
            width: 60px; height: 60px; border: 5px solid #333; border-top: 5px solid var(--main);
            border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;
            box-shadow: 0 0 20px rgba(255,0,0,0.4);
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .hidden { opacity: 0; pointer-events: none; }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Header) --- */
        header {
            background: rgba(0,0,0,0.95); padding: 15px 5%; border-bottom: 2px solid var(--main);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 5px 20px rgba(0,0,0,0.8);
        }
        .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; }
        .logo i { font-size: 30px; color: var(--main); }
        .logo div { font-family: 'Rajdhani'; font-weight: 900; font-size: 24px; line-height: 1; }
        
        .search-box { position: relative; width: 50%; max-width: 400px; margin: 0 15px; }
        .search-box input {
            width: 100%; padding: 10px 40px 10px 15px; border-radius: 25px; border: 1px solid #333;
            background: #1a1a1a; color: white; font-family: 'Cairo'; transition: 0.3s;
        }
        .search-box input:focus { border-color: var(--main); box-shadow: 0 0 10px rgba(255,0,0,0.3); }
        .search-box i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #777; }

        /* --- Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± (Slider) --- */
        .slider-container {
            width: 95%; max-width: 1200px; height: 220px; margin: 20px auto;
            border-radius: 15px; overflow: hidden; position: relative; border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; /* Ø¨ÙŠØ¸Ù‡Ø± Ù„Ùˆ ÙÙŠÙ‡ Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù…ÙŠØ²Ø© */
        }
        @media(min-width: 768px) { .slider-container { height: 400px; } }
        .slide {
            width: 100%; height: 100%; background-size: cover; background-position: center;
            position: absolute; opacity: 0; transition: opacity 1s;
        }
        .slide.active { opacity: 1; }
        .slide-content {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px; text-align: center;
        }
        .slide-title { font-size: 22px; font-weight: bold; font-family: 'Rajdhani'; text-shadow: 0 2px 5px black; }

        /* --- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (Categories) --- */
        .cats {
            padding: 10px 5%; display: flex; gap: 10px; overflow-x: auto; 
            scrollbar-width: none; white-space: nowrap; background: #0f0f0f;
        }
        .cats::-webkit-scrollbar { display: none; }
        .cat-btn {
            background: #1f1f1f; color: #aaa; padding: 8px 20px; border-radius: 30px;
            border: 1px solid #333; cursor: pointer; transition: 0.3s; font-family: 'Cairo';
        }
        .cat-btn:hover, .cat-btn.active { background: var(--main); color: white; border-color: var(--main); }

        /* --- Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ (Grid) --- */
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px; padding: 15px 5%; max-width: 1200px; margin: 0 auto;
        }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }

        /* --- Ø§Ù„ÙƒØ§Ø±Øª (Card) --- */
        .card {
            background: var(--card); border-radius: 12px; overflow: hidden; position: relative;
            border: 1px solid #222; transition: transform 0.3s, border-color 0.3s;
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--main); }
        .card.selected { border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
        
        .card-img { height: 160px; width: 100%; object-fit: cover; }
        .badge {
            position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.8);
            padding: 3px 8px; border-radius: 5px; font-size: 11px; font-weight: bold;
            border: 1px solid var(--main); z-index: 2; font-family: 'Rajdhani';
        }
        .badge-online { background: var(--gold); color: black; border: none; }
        
        .card-body { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-desc { font-size: 11px; color: #888; background: #000; padding: 5px; border-radius: 4px; margin-bottom: 10px; height: 35px; overflow: hidden; }
        
        .card-footer { margin-top: auto; display: flex; justify-content: space-between; align-items: center; }
        .btn-add {
            background: var(--main); color: white; border: none; padding: 6px 12px;
            border-radius: 5px; cursor: pointer; font-size: 12px; width: 100%; font-weight: bold;
        }
        .card.selected .btn-add { background: #25D366; } /* Ù„ÙˆÙ† Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù…Ø§ ØªØ®ØªØ§Ø± */

        /* --- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© (Cart Float) --- */
        .float-cart {
            position: fixed; bottom: 20px; right: 20px; background: #25D366; color: white;
            padding: 12px 25px; border-radius: 50px; cursor: pointer; z-index: 900;
            display: none; align-items: center; gap: 10px; box-shadow: 0 5px 20px rgba(37,211,102,0.4);
            font-weight: bold; animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0); } to { transform: scale(1); } }

        /* --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Popup) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; display: none;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #141414; width: 90%; max-width: 500px; padding: 20px;
            border-radius: 15px; border: 1px solid #333; position: relative;
            max-height: 85vh; overflow-y: auto;
        }
        .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #aaa; }
        
        .cart-item {
            display: flex; justify-content: space-between; align-items: center;
            background: #222; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #333;
        }
        .cart-info div:first-child { color: white; font-weight: bold; font-size: 14px; }
        .cart-info div:last-child { color: #888; font-size: 12px; margin-top: 3px; }
        
        .checkout-btn {
            background: #25D366; color: white; border: none; width: 100%; padding: 12px;
            border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer;
            margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (Admin) --- */
        .gear-btn {
            position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px;
            background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--main); color: var(--main); cursor: pointer; z-index: 800;
        }
        .admin-panel {
            display: none; background: #1a1a1a; padding: 20px; border-radius: 10px;
            border: 1px solid var(--main); margin: 20px 5%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .admin-input {
            width: 100%; padding: 12px; margin-bottom: 10px; background: #000;
            border: 1px solid #333; color: white; border-radius: 5px; font-family: 'Cairo';
        }
        .admin-btn { background: var(--main); color: white; width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }

    </style>
</head>
<body>

    <div id="globalLoader">
        <div class="spinner"></div>
        <h2 style="font-family:'Rajdhani'; letter-spacing:2px;">PRO GAMER</h2>
    </div>

    <div class="gear-btn" onclick="toggleAdmin()"><i class="fa-solid fa-gear"></i></div>

    <header>
        <a href="#" class="logo" onclick="location.reload()">
            <i class="fa-solid fa-gamepad"></i>
            <div>
                <span>PRO</span><span style="color:var(--main)">GAMER</span>
            </div>
        </a>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø«..." onkeyup="renderGames()">
            <i class="fa-solid fa-search"></i>
        </div>
    </header>

    <div class="admin-panel" id="adminPanel">
        <h3 style="color:var(--main); margin-top:0;">ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø¥Ø¶Ø§ÙØ© Ø£Ù„Ø¹Ø§Ø¨)</h3>
        <input type="text" id="gName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©" class="admin-input">
        <input type="text" id="gSize" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø© (GB)" class="admin-input">
        <input type="text" id="gImage" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" class="admin-input">
        <input type="text" id="gDesc" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±" class="admin-input">
        <input type="text" id="gVideo" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="admin-input">
        
        <select id="gCat" class="admin-input">
            <option value="action">Ø£ÙƒØ´Ù† (Action)</option>
            <option value="adventure">Ù…ØºØ§Ù…Ø±Ø§Øª (Adventure)</option>
            <option value="cars">Ø³ÙŠØ§Ø±Ø§Øª (Racing)</option>
            <option value="football">ÙƒØ±Ø© Ù‚Ø¯Ù… (Sports)</option>
            <option value="horror">Ø±Ø¹Ø¨ (Horror)</option>
            <option value="openworld">Ø¹Ø§Ù„Ù… Ù…ÙØªÙˆØ­</option>
            <option value="online">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Online)</option>
            <option value="bundles">Ø¹Ø±Ø¶ Ø®Ø§Øµ (Bundle)</option>
        </select>
        
        <div style="margin-bottom:15px; display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="gFeatured" style="width:20px; height:20px;">
            <label>Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± (Ù„Ø¹Ø¨Ø© Ù…Ù…ÙŠØ²Ø©)</label>
        </div>

        <button onclick="addGame()" class="admin-btn">Ø­ÙØ¸ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <p style="color:#777; font-size:12px; margin-top:10px; text-align:center;">Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±: <span id="viewCounter">0</span></p>
    </div>

    <div class="slider-container" id="heroSlider"></div>

    <div class="cats">
        <div class="cat-btn active" onclick="filterGames('all', this)">Ø§Ù„ÙƒÙ„</div>
        <div class="cat-btn" onclick="filterGames('online', this)">ğŸ”¥ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
        <div class="cat-btn" onclick="filterGames('bundles', this)">ğŸ Ø¹Ø±ÙˆØ¶</div>
        <div class="cat-btn" onclick="filterGames('action', this)">Ø£ÙƒØ´Ù†</div>
        <div class="cat-btn" onclick="filterGames('football', this)">ÙƒØ±Ø© Ù‚Ø¯Ù…</div>
        <div class="cat-btn" onclick="filterGames('cars', this)">Ø³ÙŠØ§Ø±Ø§Øª</div>
        <div class="cat-btn" onclick="filterGames('horror', this)">Ø±Ø¹Ø¨</div>
    </div>

    <div class="grid" id="gamesGrid"></div>

    <div class="float-cart" id="cartBtn" onclick="openCart()">
        <i class="fa-solid fa-check-double"></i>
        <span>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ (<span id="cartCount">0</span>)</span>
    </div>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="close-btn" onclick="closeCart()">&times;</div>
            <h2 style="font-family:'Rajdhani'; border-bottom:1px solid #333; padding-bottom:10px;">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h2>
            
            <div style="background:#222; padding:15px; border-radius:10px; margin-bottom:15px; text-align:center;">
                <div style="color:#aaa; font-size:13px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
                <div style="color:var(--gold); font-size:24px; font-weight:bold; font-family:'Rajdhani';" id="totalSizeDisplay">0 GB</div>
            </div>

            <div id="cartItemsList"></div>

            <button class="checkout-btn" onclick="sendWhatsApp()">
                <i class="fa-brands fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ØªØ³Ø¹ÙŠØ±
            </button>
            <button onclick="clearCart()" style="width:100%; background:none; border:none; color:#ff4444; margin-top:10px; cursor:pointer;">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB...",
            authDomain: "gamer-store-77.firebaseapp.com",
            projectId: "gamer-store-77",
            storageBucket: "gamer-store-77.appspot.com",
            messagingSenderId: "539826372007",
            appId: "1:539826372007:web:c8e76a..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let games = [];
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        let currentCat = 'all';
        let isAdmin = false;

        // Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = () => {
            setTimeout(() => document.getElementById('globalLoader').classList.add('hidden'), 1500);
            updateStats();
        };

        async function updateStats() {
            const ref = doc(db, "settings", "stats");
            try {
                await setDoc(ref, { visits: (await getDoc(ref)).data()?.visits + 1 || 1 }, { merge: true });
                const snap = await getDoc(ref);
                if(snap.exists()) document.getElementById("viewCounter").innerText = snap.data().visits;
            } catch(e) { console.log("Stats Error"); }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        onSnapshot(collection(db, "games"), (snapshot) => {
            games = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            renderGames();
            updateCartUI();
            initSlider();
        });

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨
        window.renderGames = () => {
            const grid = document.getElementById("gamesGrid");
            grid.innerHTML = "";
            const search = document.getElementById("searchInput").value.toLowerCase();

            const filtered = games.filter(g => {
                return (currentCat === 'all' || g.cat === currentCat) && 
                       g.name.toLowerCase().includes(search);
            });

            if(!filtered.length) {
                grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#555; padding:40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>`;
                return;
            }

            filtered.forEach(g => {
                const isSelected = cart.includes(g.id);
                const isOnline = g.cat === 'online';
                const isBundle = g.cat === 'bundles';
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¸Ù‡Ø± Ù…ÙƒØ§Ù† Ø§Ù„Ø³Ø¹Ø±
                let badgeText = `${g.size} GB`;
                let badgeClass = '';
                
                if(isOnline) { badgeText = 'ONLINE'; badgeClass = 'badge-online'; }
                if(isBundle) { badgeText = 'Ø¹Ø±Ø¶ Ø®Ø§Øµ'; badgeClass = 'badge-online'; }

                const div = document.createElement('div');
                div.className = `card ${isSelected ? 'selected' : ''}`;
                div.innerHTML = `
                    <div class="badge ${badgeClass}">${badgeText}</div>
                    <img src="${g.image}" class="card-img" loading="lazy">
                    <div class="card-body">
                        <div class="card-name">${g.name}</div>
                        <div class="card-desc">${g.desc || (isOnline ? 'ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†' : 'Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø©')}</div>
                        <div class="card-footer">
                            <span style="font-size:12px; color:#666;">${isOnline ? 'Active' : 'Offline'}</span>
                            <button class="btn-add" onclick="toggleCart('${g.id}')">
                                ${isSelected ? 'ØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±' : 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©'}
                            </button>
                        </div>
                        ${isAdmin ? `<button onclick="delGame('${g.id}')" style="margin-top:5px; background:red; color:white; border:none; width:100%;">Ø­Ø°Ù</button>` : ''}
                    </div>
                `;
                grid.appendChild(div);
            });
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø©
        window.toggleCart = (id) => {
            if(cart.includes(id)) {
                cart = cart.filter(x => x !== id);
            } else {
                cart.push(id);
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
                const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1000, background:'#25D366', color:'#fff' });
                Toast.fire({ icon: 'success', title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©' });
            }
            updateCartUI();
            renderGames(); // Ø¹Ø´Ø§Ù† Ù†Ø­Ø¯Ø« Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§Ø±
        };

        window.updateCartUI = () => {
            localStorage.setItem('myCart', JSON.stringify(cart));
            const list = document.getElementById("cartItemsList");
            list.innerHTML = "";
            let totalGB = 0;
            
            const selectedGames = games.filter(g => cart.includes(g.id));
            
            selectedGames.forEach(g => {
                let size = Number(g.size) || 0;
                totalGB += size;
                
                list.innerHTML += `
                    <div class="cart-item">
                        <div class="cart-info">
                            <div>${g.name}</div>
                            <div>${g.cat === 'online' ? 'Online' : size + ' GB'}</div>
                        </div>
                        <i class="fa-solid fa-trash" style="color:#ff4444; cursor:pointer;" onclick="toggleCart('${g.id}')"></i>
                    </div>
                `;
            });

            document.getElementById("cartCount").innerText = cart.length;
            document.getElementById("totalSizeDisplay").innerText = totalGB.toFixed(1) + " GB";
            
            const floatBtn = document.getElementById("cartBtn");
            if(cart.length > 0) floatBtn.style.display = "flex";
            else {
                floatBtn.style.display = "none";
                closeCart();
            }
        };

        window.clearCart = () => {
            cart = [];
            updateCartUI();
            renderGames();
        };

        // Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ø¯ÙˆÙ† Ø£Ø³Ø¹Ø§Ø±)
        window.sendWhatsApp = () => {
            const selectedGames = games.filter(g => cart.includes(g.id));
            let msg = "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ù…Ø­ØªØ§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠ: \n\n";
            let totalGB = 0;

            selectedGames.forEach((g, index) => {
                let note = g.cat === 'online' ? "(Online ğŸŒ)" : `(${g.size} GB)`;
                if(g.cat === 'bundles') note = "(Bundle ğŸ)";
                msg += `${index + 1}. ${g.name} ${note}\n`;
                totalGB += Number(g.size) || 0;
            });

            msg += `\nğŸ“Š *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${selectedGames.length} Ø£Ù„Ø¹Ø§Ø¨`;
            msg += `\nğŸ’¾ *Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:* ${totalGB.toFixed(1)} GB`;
            msg += `\n\nØ¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¯ Ø¨Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©.`;

            window.open(`https://wa.me/201500372007?text=${encodeURIComponent(msg)}`, '_blank');
        };

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        window.openCart = () => document.getElementById("cartModal").style.display = "flex";
        window.closeCart = () => document.getElementById("cartModal").style.display = "none";
        
        window.filterGames = (cat, btn) => {
            currentCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderGames();
        };

        // Ø§Ù„Ø£Ø¯Ù…Ù†
        window.toggleAdmin = async () => {
            if(isAdmin) {
                isAdmin = false;
                document.getElementById("adminPanel").style.display = "none";
            } else {
                const { value: pass } = await Swal.fire({ title: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', input: 'password', background:'#222', color:'white' });
                if(pass === "372007") {
                    isAdmin = true;
                    document.getElementById("adminPanel").style.display = "block";
                    renderGames(); // Ø¹Ø´Ø§Ù† Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù ÙŠØ¸Ù‡Ø±
                }
            }
        };

        window.addGame = async () => {
            const name = document.getElementById("gName").value;
            const size = document.getElementById("gSize").value;
            const image = document.getElementById("gImage").value;
            const cat = document.getElementById("gCat").value;
            const desc = document.getElementById("gDesc").value;
            const video = document.getElementById("gVideo").value;
            const featured = document.getElementById("gFeatured").checked;

            if(!name || !image) return Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†', 'error');

            await addDoc(collection(db, "games"), {
                name, size: Number(size), image, cat, desc, video, featured,
                createdAt: new Date()
            });

            Swal.fire({ icon: 'success', title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©', showConfirmButton: false, timer: 1000 });
            document.getElementById("gName").value = "";
        };

        window.delGame = async (id) => {
            if(confirm("Ù…Ø³Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                await deleteDoc(doc(db, "games", id));
            }
        };

        // Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±
        function initSlider() {
            const container = document.getElementById("heroSlider");
            const feats = games.filter(g => g.featured);
            
            if(!feats.length) { container.style.display = "none"; return; }
            
            container.style.display = "block";
            container.innerHTML = "";
            
            feats.forEach((g, i) => {
                const div = document.createElement("div");
                div.className = i === 0 ? "slide active" : "slide";
                div.style.backgroundImage = `url('${g.image}')`;
                div.innerHTML = `<div class="slide-content"><div class="slide-title">${g.name}</div></div>`;
                container.appendChild(div);
            });

            let idx = 0;
            setInterval(() => {
                const slides = document.querySelectorAll(".slide");
                if(!slides.length) return;
                slides[idx].classList.remove("active");
                idx = (idx + 1) % slides.length;
                slides[idx].classList.add("active");
            }, 3000);
        }
    </script>
</body>
</html>
